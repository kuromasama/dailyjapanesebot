# Daily Japanese N2 衝刺計畫 - 版本演進日誌

這份文件記錄了 `Daily_Japanese` 專案從早期版本到最新版本的主要功能與 AI 提示詞 (Prompt) 的演進歷史。

---

## v0.0.23 (2026-01-19)
**類型：錯誤修復 (Bug Fix) & 品質強化 (Quality Enhancement)**

- **核心錯誤修復：** **徹底修復了 v0.0.22 中斷的「即時難度調整」回饋循環**。`process_data` 函數現在能正確解析 `ai_correction` 回傳的 `assessments` 陣列，並根據 AI 的**逐句評分**，即時、獨立地微調 `difficulty_cn_jp` 和 `difficulty_jp_cn` 的雙軌難度值。
- **新增功能：「平均戰力評級」**。在批改訊息的末尾，新增了對本次所有回答的平均分數總結，並根據分數給出 `SSS / S / A / B / C` 的戰力評級 (Rank)，極大增強了遊戲化回饋。
- **AI Prompt 繼承與實裝：** 完整繼承了 v0.0.22 設下的「逐句評分 + 創意人格 + 多樣化開場白」的最高品質要求，並在一個功能完整的系統中使其完全發揮作用。
- **結論：** **歷代版本的集大成者**。它修復了最關鍵的缺陷，融合了歷代版本的優點，是功能最完整、AI 最聰明、回饋循環最完善的**黃金版本**。

---

## v0.0.22 (2026-01-19)
**類型：品質強化 & 嚴重錯誤引入**

- **AI 人格飛躍 (Prompt 升級)：**
    1.  **`ai_correction`**：Prompt 發生根本性重構，要求 AI 必須**逐句評分**，並針對每一句給出**即興創作的、有人味的毒舌或讚美短評**。JSON 格式也升級為 `assessments` 陣列。
    2.  **`run_daily_quiz`**：Prompt 新增指令，要求 AI 的每日開場白必須**多樣化、不重複**，使其更像一個活生生的教練。
- **【嚴重錯誤】：** 後端 `process_data` 函數**未能跟上 Prompt 的升級**。程式碼沒有解析新的 `assessments` 陣列，且完全移除了難度調整的邏輯，導致 AI 的精細評分被完全浪費，**「即時難度調整」回饋循環中斷**。
- **結論：** 一個在 AI 互動和人格塑造上遙遙領先，但在核心功能實現上存在**致命缺陷的「半成品」**。

---

## v0.0.21 (2026-01-19)
**類型：核心功能升級 (雙軌制)**

- **核心功能升級：「雙軌制難度系統」**。首次將單一的 `current_difficulty` 拆分為 `difficulty_cn_jp` (中翻日/輸出) 和 `difficulty_jp_cn` (日翻中/輸入)，實現了對不同能力的分別評估。
- **核心功能升級：「即時評分回饋」**。`ai_correction` 的 Prompt 新增「評分」要求，AI 會給出一個**總分**。`process_data` 函數能根據這個分數，**即時微調**對應的雙軌難度，讓回饋循環從「每日」縮短到「每次」。
- **結論：** 一次成功的架構重寫，讓學習系統的精細度和即時性大幅提升。

---

## v0.0.20 (2026-01-19)
**類型：配置修正與日誌策略還原**

- **邏輯修正：** 修正了新使用者的起始難度 (`START_DIFFICULTY`) 與預設難度 (`current_difficulty`) 不一致的問題 (從 2.0 -> 1.0)，避免了新使用者在第一天就被系統誤判為「進度落後」。
- **代碼優化：** 將使用者資料中的預設難度與全域變數 `START_DIFFICULTY` 掛鉤，提升了程式碼的可維護性。
- **策略還原：** 再次將日誌記錄方式從「截斷模式」還原為「完整記錄模式」，確保了 AI 的所有回覆都能被完整追蹤。

---

## v0.0.19 (2026-01-19)
**類型：程式碼健壯性增強與配置回滾**

- **穩定性增強：**
    1.  增加了對 Telegram `edited_message` 的處理，透過安全讀取 `message` 物件，避免了因非預期訊息類型導致的程式崩潰。
    2.  優化了主錯誤處理機制，在讀取 `user_data.json` 失敗時，會返回一個結構完整的預設物件，避免了連鎖性錯誤。
- **配置回滾：** 將日誌記錄方式從「完整記錄」回滾至「截斷模式」。
- **AI Prompt：** 與 v0.0.18 完全相同，**無任何變更**。

---

## v0.0.18 (2026-01-19)
**類型：細節修復 (日誌)**

- **日誌修正：** 移除了 `send_telegram` 函數中對日誌內容 100 字的截斷限制，確保 AI 的教學與批改內容可以被**完整地**記錄在 `TG_MSG.log` 中，大幅提升了問題的可追溯性。
- **AI Prompt：** 與 v0.0.17 完全相同，**無任何變更**。

---

## v0.0.17 (2026-01-19)
**類型：品質強化更新**

- **AI Prompt 增強：** 在 `run_daily_quiz`（每日測驗與 Bonus）的提示詞中，加入了明確的**「🚫 品質紅線」**要求：
    1.  **嚴禁「中式日文 (Chinglish)」**，要求答案必須是完全道地的母語人士用法。
    2.  **嚴禁「日式中文 (翻譯腔)」**，要求題目必須是自然流暢的台灣繁體中文。
- **核心功能與 AI 人格：** 與 v0.f.16 完全相同，無任何簡化或修改。

---

## v0.0.16 (2026-01-19)
**類型：AI 人格還原與增強**

- **AI Prompt 完美修復：**
    1.  **還原並增強了 `get_sprint_status` 的評語**，使其比 v0.0.14 的版本更生動、更有教練的語氣 (例如：「皮繃緊一點！」、「N2 根本是囊中之物！」)。
    2.  **還原並增強了 `run_daily_quiz` 的情境化情緒指令**，為 AI 提供了更具體的「劇本」(例如：「用有點受傷但又好笑的語氣，質問她是不是被被窩綁架了？」)，並將 Bonus 挑戰的誘惑語氣描述得極其細膩。
- **功能完整性：** 100% 保留了 v0.0.15 的「弱點學習系統」。
- **結論：** 完美融合了 v0.0.14 的靈魂 (AI 人格) 和 v0.0.15 的大腦 (智慧功能)。

---

## v0.0.15 (2026-01-19)
**類型：核心功能升級 (智慧化)**

- **核心功能新增：「弱點學習與動態權重系統」**
    1.  **錯誤自動捕捉：** 在 `ai_correction` 的提示詞中新增指令，要求 AI 以 JSON 格式回報使用者犯的錯誤。
    2.  **動態權重調整：** 程式會解析 AI 回傳的 JSON，對答錯的單字/文法增加權重 (懲罰)，對答對的項目降低權重 (獎勵)。
    3.  **智慧化出題：** `run_daily_quiz` 的出題邏輯被重寫，會**優先選擇權重最高的項目 (弱點)** 來出題，並在提示詞中明確要求 AI 必須使用這些弱點造句。
- **AI Prompt 簡化 (負面變更)：** 為了實現新功能，在重構過程中大幅簡化了 `get_sprint_status` 和 `run_daily_quiz` 中的 AI 情緒指令與人格描述，導致 AI 的生動性下降。

---

## v0.0.14 (2026-01-19)
**類型：AI 人格原型**

- **AI Prompt 亮點：** 此版本擁有**最原始、最詳細、最生動的 AI 人格劇本**。`run_daily_quiz` 中的 `emotion_prompt` 針對不同使用者表現（優異、普通、偷懶、完成 Bonus）定義了極其豐富和情境化的反應，是後續版本 AI 人格的「黃金標準」。
- **功能：** 具備每日測驗、Bonus 挑戰、等級評估等核心框架，但出題為隨機選擇，缺乏針對性。

---

## v0.0.10 ~ v0.0.13 (推斷)
**類型：功能迭代與優化**

- 根據 v0.0.9 到 v0.0.14 的變化推斷，這個階段可能進行了以下工作：
    - **無限等級系統 (`get_difficulty_description`) 的引入：** 取代了寫死的 `difficulty_levels` 字典，使得難度可以動態擴展到 Lv8 甚至更高。
    - **衝刺計畫 (`get_sprint_status`) 的完善：** 加入了與預期進度的比較、落後/超前天數的計算等功能。
    - **日誌系統 (`write_log_file`) 的建立：** 開始將每日的狀態和對話記錄到 `TG_MSG.log` 中。

---

## v0.0.9 (參考點)
**類型：早期原型**

- **功能：** 已具備每日測驗和 Bonus 挑戰的基本框架。
- **AI Prompt：**
    - Bonus 挑戰的提示詞已經有了「誘惑力」和「魔鬼教練」的雛形，但還不夠細膩。
    - 出題邏輯僅基於「今日單字庫」，**沒有「弱點」概念**。
- **技術細節：** 難度等級描述使用寫死的字典 `difficulty_levels`，擴展性較差。

---

## v0.0.1 ~ v0.0.8 (推斷)
**類型：基礎建設**

- 這個最早期的階段，主要集中在建立專案的基礎骨架。
- **主要工作推測：**
    - 建立與 Telegram API 的連接 (`send_telegram`, `getUpdates`)。
    - 設計 `vocab.json` 和 `user_data.json` 的基本資料結構。
    - 實現基本的單字收錄、讀取與寫入 (`load_json`, `save_json`)。
    - 搭建 `run_daily_quiz` 和 `ai_correction` 的初始函式框架。
    - 與 Gemini API 的初步對接。
